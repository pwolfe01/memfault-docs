---
id: arm-cortex-m-guide
title: ARM Cortex-M Integration Guide
sidebar_label: ARM Cortex-M
description: "Integrate Memfault for a Cortex-M device."
---

import ProjectAwareCreateAProject from "@site/src/components/ProjectAwareCreateAProject";

import TryFlow from "@site/src/pages/_partials/_steps/_try-flow.mdx";
import CloneSdk from "@site/src/pages/_partials/_steps/_clone-sdk.mdx";
import AddSources from "@site/src/pages/_partials/_steps/_add-sources.mdx";
import CorePlatformDependencies from "@site/src/pages/_partials/_steps/_core-platform-dependencies.mdx";
import AddBuildIdIntro from "@site/src/pages/_partials/_steps/_add-build-id-intro.mdx";
import AddBuildId from "@site/src/pages/_partials/_steps/_add-build-id.mdx";
import LoggingDependency from "@site/src/pages/_partials/_steps/_logging-dependency.mdx";
import RtosPorts from "@site/src/pages/_partials/_steps/_rtos-ports.mdx";
import CoredumpDependency from "@site/src/pages/_partials/_steps/_coredump-dependency.mdx";
import RegisterAssert from "@site/src/pages/_partials/_steps/_register-assert.mdx";
import UploadSymbolFile from "@site/src/pages/_partials/_steps/_upload-symbol-file.mdx";
import PostChunksLocally from "@site/src/pages/_partials/_steps/_post-chunks-locally.mdx";
import PublishDataToCloud from "@site/src/pages/_partials/_steps/_publish-data-to-cloud.mdx";
import DefineFirstTraceEvent from "@site/src/pages/_partials/_steps/_define-first-trace-event.mdx";
import DefineFirstHeartbeat from "@site/src/pages/_partials/_steps/_define-first-heartbeat.mdx";
import AddCliTestCommands from "@site/src/pages/_partials/_steps/_add-cli-test-commands.mdx";
import FwSdkFeatures from "@site/src/pages/_partials/_steps/_sdk-features.mdx";
import MetricTimerDependency from "@site/src/pages/_partials/_steps/_metric-timer-dependency.mdx";
import RebootTrackingDependency from "@site/src/pages/_partials/_steps/_reboot-tracking-dependency.mdx";

## Overview

The following guide will walk you through step-by-step how to integrate and test
the Memfault SDK for a Cortex-M device using the GNU GCC, Clang, IAR, ARM MDK,
or TI ARM Compiler.

<FwSdkFeatures />

## Pre-Integration

### (Optionally) Collect a coredump capture using GDB

<TryFlow />

<ProjectAwareCreateAProject />

## Integration Steps

### Prepare folder for memfault-firmware-sdk & port

<CloneSdk />

### Add Sources to Build System

<AddSources />

### Core Dependencies

<CorePlatformDependencies />

### Reboot Tracking Dependencies

<RebootTrackingDependency />

### Logging Dependency

<LoggingDependency />

### Timer Dependencies

<MetricTimerDependency />

### RTOS Port Files

<RtosPorts />

### Register Assert Handler

<RegisterAssert />

### Check Exception Handler Implementations

Memfault provides exception handler implementations that need to be invoked via
the system's vector table. The SDK by default provides implementations for these
handlers using the CMSIS standard names:

- HardFault_Handler
- MemoryManagement_Handler
- BusFault_Handler
- UsageFault_Handler
- NMI_Handler
- MemfaultWatchdog_Handler

Typically the default implementations will be weakly defined, so the Memfault
implementations will automatically be used. It may be necessary to mark the
default implementation with the appropriate `weak` annotation, or delete the
default implementations altogether so the Memfault implementations can be used.

If the entries in the vector table for those handlers are named differently,
either change the names to match the CMSIS standard ones, or set the necessary
[config options](https://github.com/memfault/memfault-firmware-sdk/blob/920a1ee607963206901615ac2f395e3124e7c3a6/components/include/memfault/default_config.h#L366-L388)
in `memfault_platform_config.h` to override the names.

### Implement Coredump Storage Dependency

<CoredumpDependency />

### Add a Unique Identifier to target

<AddBuildIdIntro />
<AddBuildId />

### Confirm Integration Links

At this point, your project should compile and be able to boot. On startup you
should see some messaging like the following print when
`memfault_platform_boot()` is called:

```
[I] Memfault Build ID: cefaeb9407ab0dac7a5efe9fd510618ee21e9df7
[I] S/N: MFLT0123
[I] SW type: app-fw
[I] SW version: 1.0.0+cefaeb940
[I] HW version: dvt1
[I] Reset Reason, RESETREAS=0x4
[I] Reset Causes:
[I]  Software
[I] Memfault Initialized!
```

## Verification & Tuning Steps

With Memfault compiling into your build, it's now time to add some initial
instrumentation, and test the integration!

### Define First Trace Event

<DefineFirstTraceEvent />

### Define First Heartbeat

<DefineFirstHeartbeat />

### Add Test Commands to CLI

<AddCliTestCommands />

### Post Data to Cloud via Local Debug Setup

<PostChunksLocally />

### Upload Symbol File

<UploadSymbolFile />

### Troubleshooting Data Transfer

See the docs on
[data transfer troubleshooting](/docs/troubleshooting/data-transfer-troubleshooting).

## Data Transport Steps

With data collection verified locally, the final step is to push data
automatically to the Memfault cloud for analysis.

### Post Data to Cloud via Device Transport

<PublishDataToCloud />
